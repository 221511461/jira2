<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/public/css-reset/bundle.css" media="all" />
    <link rel="stylesheet" href="/public/atlassian-ui-kit/bundle.css" media="all" />
    <link rel="stylesheet" href="/public/css/styles.css" media="all" />
    <script src="/public/js/jquery.min.js"></script>
  </head>
  <body class="aui-page-hybrid">
    <div class="ac-content">
      <div class="page-content">
        <header class="title">
          <h1>Stafftools</h1>
        </header>
        <section class="content">
          Installation ID: {{ installationId }}
        </section>

        <table>
              <thead>
                <tr>
                  <th>Organization</th>
                  <th>Repositories</th>
                  <th>Added</th>
                  <th></th>
                  <th>Sync Status</th>
                  <th>Sync</th>
                  <th>Migration</th>
                </tr>
              </thead>
               <tbody>
                {{#each connections}}
                  <tr>
                    <td><img class="connection-avatar" src="{{ account.avatar_url }}" height="24" width="24" /> {{ account.login }}</td>
                    <td>
                      {{#if isGlobalInstall }}
                        All
                      {{else}}
                        Selected
                      {{/if}}
                    </td>
                    <td>{{ updated_at }}</td>
                    <td>
                      <button class="ak-button ak-button__appearance-link delete-connection-link" data-installation-id="{{ id }}">Remove</button>
                      <a class="ak-button ak-button__appearance-link configure-connection-link" href="{{ html_url }}" data-installation-link="{{ html_url }}" target="_blank">Configure</a>
                    </td>
                    <td>
                      <span id="{{id}}-status"> {{ syncStatus }} </span>
                    </td>
                    <td>
                      <input type="hidden" id="_csrf" name="_csrf" value="{{../csrfToken}}">
                      <button style="background: rgb(0, 82, 204);color: white;" class="ak-button ak-button__appearance-link sync-connection-link" data-jira-host="{{ ../host }}" data-installation-id="{{ id }}">Retry</button>
                    </td>
                    <td>
                      <form method="POST" action="/stafftools/{{ id }}">
                        <input type="hidden" id="jiraHost" name="jiraHost" value="{{ ../host }}" />
                        <button style="background: rgb(0, 82, 204);color: white;" class="ak-button ak-button__appearance-link">Complete</button>
                      </form>
                      <form method="POST" action="/stafftools/{{ id }}/undo">
                        <input type="hidden" id="jiraHost" name="jiraHost" value="{{ ../host }}" />
                        <button style="background: rgb(0, 82, 204);color: white;" class="ak-button ak-button__appearance-link">Undo</button>
                      </form>
                    </td>
                  </tr>
                  <tr>
                    <pre>
                      {{json repoSyncState }}
                    </pre>
                  </tr>
                {{/each}}
                {{#each failedConnections}}
                  <tr>
                    <td class="error-message">
                      #{{ id }}
                      {{#if deleted}}
                        This installation seems to be removed from GitHub but not from the database
                      {{else}}
                        There was an error getting the information of this installation
                      {{/if}}
                    </td>
                    <td></td>
                    <td>{{ updated_at }}</td>
                    <td>
                      <button class="ak-button ak-button__appearance-link delete-connection-link" data-installation-id="{{ id }}">Remove</button>
                    </td>
                  </tr>
                {{/each}}
              </tbody>
          </table>

      <script src="/public/js/jira-configuration.js"></script>
    </div>
    <script src="{{host}}/atlassian-connect/all.js"></script>
  </body>
</html>
